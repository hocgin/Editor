"use strict";(self.webpackChunk_hocgin_editor=self.webpackChunk_hocgin_editor||[]).push([[465],{64902:function(K,m,o){o.r(m);var f=o(21140),E=o.n(f),P=o(63466),C=o.n(P),M=o(52510),s=o.n(M),u=o(43906),g=o(69598),d=o(12910),O=o(13187),c=o.n(O),D=o(13838),R=o.n(D),p=o(48220),U=o.n(p),A=o(13440),W=o.n(A),B=o(7699),T=o.n(B),L=o(88747),S=o.n(L),y=o(18732),w=o.n(y),b=o(23686),x=o(38203),I=function(){function _(r,e,t,n){var i=this;E()(this,_),s()(this,"node",void 0),s()(this,"view",void 0),s()(this,"schema",void 0),s()(this,"cm",void 0),s()(this,"dom",void 0),s()(this,"getPos",void 0),s()(this,"updating",void 0),s()(this,"incomingChanges",void 0),this.node=r,this.view=e,this.schema=r.type.schema,this.getPos=t,this.updating=!1,this.incomingChanges=!1,this.cm=c()(null,{value:r.textContent,lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,autoCloseTags:!0,mode:n,readOnly:!e.editable}),this.dom=this.cm.getWrapperElement(),setTimeout(function(){return i.cm.refresh()},50),this.cm.on("beforeChange",function(){return i.incomingChanges=!0}),this.cm.on("cursorActivity",function(){!i.updating&&!i.incomingChanges&&i.forwardSelection(),i.cm.setOption("readOnly",!i.view.editable)}),this.cm.on("changes",function(){i.updating||(i.valueChanged(),i.forwardSelection()),i.incomingChanges=!1}),this.cm.on("focus",function(){return i.forwardSelection()})}return C()(_,[{key:"forwardSelection",value:function(){if(this.cm.hasFocus()){console.log("this.view",this.view);var e=this.view.state,t=this.asProseMirrorSelection(e.doc);t.eq(e.selection)||this.view.dispatch(e.tr.setSelection(t))}}},{key:"asProseMirrorSelection",value:function(e){var t=this.getPos()+1,n=this.cm.indexFromPos(this.cm.getCursor("anchor"))+t,i=this.cm.indexFromPos(this.cm.getCursor("head"))+t;return u.Bs.create(e,n,i)}},{key:"valueChanged",value:function(){var e=v(this.node.textContent,this.cm.getValue());if(e){var t=this.getPos()+1,n=this.view.state.tr.replaceWith(t+e.from,t+e.to,e.text?this.schema.text(e.text):[]);this.view.dispatch(n)}}},{key:"codeMirrorKeymap",value:function(){var e,t=this,n,i=this.view,l=typeof window!="undefined"&&typeof navigator!="undefined"?(e=navigator)===null||e===void 0?void 0:e.platform:"",h=/Mac/.test(l)?"Cmd":"Ctrl";return c().normalizeKeyMap((n={Up:function(){return t.maybeEscape("line",-1)},Left:function(){return t.maybeEscape("char",-1)},Down:function(){return t.maybeEscape("line",1)},Right:function(){return t.maybeEscape("char",1)},"Ctrl-Enter":function(){(0,g.uo)(i.state,i.dispatch)&&i.focus()}},s()(n,"".concat(h,"-Z"),function(){return(0,d.Yw)(i.state,i.dispatch)}),s()(n,"Shift-".concat(h,"-Z"),function(){return(0,d.KX)(i.state,i.dispatch)}),s()(n,"".concat(h,"-Y"),function(){return(0,d.KX)(i.state,i.dispatch)}),n))}},{key:"maybeEscape",value:function(e,t){var n=this.cm.getCursor();if(this.cm.somethingSelected()||n.line!=(t<0?this.cm.firstLine():this.cm.lastLine())||e=="char"&&n.ch!=(t<0?0:this.cm.getLine(n.line).length))return c().Pass;this.view.focus();var i=this.getPos()+(t<0?0:this.node.nodeSize),l=u.Y1.near(this.view.state.doc.resolve(i),t);return this.view.dispatch(this.view.state.tr.setSelection(l).scrollIntoView()),this.view.focus(),null}},{key:"update",value:function(e){if(e.type!==this.node.type)return!1;this.node=e;var t=v(this.cm.getValue(),e.textContent);return t&&(this.updating=!0,this.cm.replaceRange(t.text,this.cm.posFromIndex(t.from),this.cm.posFromIndex(t.to)),this.updating=!1),!0}},{key:"setSelection",value:function(e,t){console.log("CodeBlockView - setSelection"),this.cm.focus(),this.updating=!0,this.cm.setSelection(this.cm.posFromIndex(e),this.cm.posFromIndex(t)),this.updating=!1}},{key:"selectNode",value:function(){console.log("CodeBlockView - selectNode"),this.cm.focus()}},{key:"stopEvent",value:function(){return!0}}]),_}();function v(_,r){if(_===r)return null;for(var e=0,t=_.length,n=r.length;e<t&&_.charCodeAt(e)===r.charCodeAt(e);)++e;for(;t>e&&n>e&&_.charCodeAt(t-1)===r.charCodeAt(n-1);)t--,n--;return{from:e,to:t,text:r.slice(e,n)}}m.default=I}}]);
