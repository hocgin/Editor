"use strict";(self.webpackChunk_hocgin_editor=self.webpackChunk_hocgin_editor||[]).push([[465],{64902:function(B,l,o){o.r(l);var f=o(21140),E=o.n(f),P=o(63466),C=o.n(P),M=o(52510),_=o.n(M),u=o(43906),g=o(69598),d=o(12910),O=o(13187),c=o.n(O),D=o(13838),R=o.n(D),p=o(48220),U=o.n(p),A=o(13440),W=o.n(A),L=o(7699),T=o.n(L),y=o(88747),S=o.n(y),I=o(18732),b=o.n(I),w=o(23686),x=o(38203),K=function(){function s(n,e,t,r){var i=this;E()(this,s),_()(this,"node",void 0),_()(this,"view",void 0),_()(this,"schema",void 0),_()(this,"cm",void 0),_()(this,"dom",void 0),_()(this,"getPos",void 0),_()(this,"updating",void 0),_()(this,"incomingChanges",void 0),this.node=n,this.view=e,this.schema=n.type.schema,this.getPos=t,this.updating=!1,this.incomingChanges=!1,this.cm=c()(null,{value:n.textContent,lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,autoCloseTags:!0,mode:r,readOnly:!e.editable}),this.dom=this.cm.getWrapperElement(),setTimeout(function(){return i.cm.refresh()},50),this.cm.on("beforeChange",function(){return i.incomingChanges=!0}),this.cm.on("cursorActivity",function(){!i.updating&&!i.incomingChanges&&i.forwardSelection(),i.cm.setOption("readOnly",!i.view.editable)}),this.cm.on("changes",function(){i.updating||(i.valueChanged(),i.forwardSelection()),i.incomingChanges=!1}),this.cm.on("focus",function(){return i.forwardSelection()})}return C()(s,[{key:"forwardSelection",value:function(){if(this.cm.hasFocus()){var e=this.view.state,t=this.asProseMirrorSelection(e.doc);t.eq(e.selection)||this.view.dispatch(e.tr.setSelection(t))}}},{key:"asProseMirrorSelection",value:function(e){var t=this.getPos()+1,r=this.cm.indexFromPos(this.cm.getCursor("anchor"))+t,i=this.cm.indexFromPos(this.cm.getCursor("head"))+t;return u.Bs.create(e,r,i)}},{key:"valueChanged",value:function(){var e=v(this.node.textContent,this.cm.getValue());if(e){var t=this.getPos()+1,r=this.view.state.tr.replaceWith(t+e.from,t+e.to,e.text?this.schema.text(e.text):[]);this.view.dispatch(r)}}},{key:"codeMirrorKeymap",value:function(){var e,t=this,r,i=this.view,m=typeof window!="undefined"&&typeof navigator!="undefined"?(e=navigator)===null||e===void 0?void 0:e.platform:"",h=/Mac/.test(m)?"Cmd":"Ctrl";return c().normalizeKeyMap((r={Up:function(){return t.maybeEscape("line",-1)},Left:function(){return t.maybeEscape("char",-1)},Down:function(){return t.maybeEscape("line",1)},Right:function(){return t.maybeEscape("char",1)},"Ctrl-Enter":function(){(0,g.uo)(i.state,i.dispatch)&&i.focus()}},_()(r,"".concat(h,"-Z"),function(){return(0,d.Yw)(i.state,i.dispatch)}),_()(r,"Shift-".concat(h,"-Z"),function(){return(0,d.KX)(i.state,i.dispatch)}),_()(r,"".concat(h,"-Y"),function(){return(0,d.KX)(i.state,i.dispatch)}),r))}},{key:"maybeEscape",value:function(e,t){var r=this.cm.getCursor();if(this.cm.somethingSelected()||r.line!=(t<0?this.cm.firstLine():this.cm.lastLine())||e=="char"&&r.ch!=(t<0?0:this.cm.getLine(r.line).length))return c().Pass;this.view.focus();var i=this.getPos()+(t<0?0:this.node.nodeSize),m=u.Y1.near(this.view.state.doc.resolve(i),t);return this.view.dispatch(this.view.state.tr.setSelection(m).scrollIntoView()),this.view.focus(),null}},{key:"update",value:function(e){if(e.type!==this.node.type)return!1;this.node=e;var t=v(this.cm.getValue(),e.textContent);return t&&(this.updating=!0,this.cm.replaceRange(t.text,this.cm.posFromIndex(t.from),this.cm.posFromIndex(t.to)),this.updating=!1),!0}},{key:"setSelection",value:function(e,t){this.cm.focus(),this.updating=!0,this.cm.setSelection(this.cm.posFromIndex(e),this.cm.posFromIndex(t)),this.updating=!1}},{key:"selectNode",value:function(){this.cm.focus()}},{key:"stopEvent",value:function(){return!0}}]),s}();function v(s,n){if(s===n)return null;for(var e=0,t=s.length,r=n.length;e<t&&s.charCodeAt(e)===n.charCodeAt(e);)++e;for(;t>e&&r>e&&s.charCodeAt(t-1)===n.charCodeAt(r-1);)t--,r--;return{from:e,to:t,text:n.slice(e,r)}}l.default=K}}]);
